{% extends 'base.html' %} {% load static %}
 {% block title %}Home{% endblock %}
{% block content %}
{% if messages %}
 {% for message in messages %}
    <script>
      alert("{{ message }}")
    </script>
  {% endfor %}
    
{% endif %}


<!-- Welcome Section -->
<div class="welcome-section">
  <h1>Welcome to <span>PixelAura+</span> âœ¨</h1>
  <p>
    Your creative journey starts here. Share your first post or explore content
    from featured creators.
  </p>
</div>

<div class="suggested-panel">
  <!-- âœ… LOGGED IN USER -->

  <!-- âœ… HEADER -->
  <div class="suggest-header">
    <span>Suggested for you</span>
  </div>

  <div class="story-suggest-wrapper">
    <!-- âœ… LEFT SIDE: HORIZONTAL SUGGESTED CREATORS -->
    <div class="story-logos-row">
      {% for u in ulist %}
      <div class="logo-wrapper">
        <a href="{% url 'suggested_user_profile' u.username   %}">
          {% if u.image %}
          <img src="{{ u.image }}" class="suggest-img" />
          {% else %}
          <img
            src="{% static 'images/default-user.png' %}"
            class="suggest-img"
          />
          {% endif %}
        </a>
        <p class="logo-name">{{ u.username }}</p>
      </div>
      {% endfor %}
    </div>

    <!-- âœ… RIGHT SIDE: MAIN USER -->
    <div class="main-user-box">
      <a href="{% url 'profile' %}" class="profile-link">
        {% if profile.image %}
        <img
          src="{{ profile.image }}"
          class="logo-wrapper user-logo suggest-img"
        />
        {% else %}

        <div class="default-avatar">
          <i class="bx bxs-user"></i>
        </div>
        {% endif %}
      </a>

      <div class="main-user-text">
        <span class="main-username">{{ datas.username }}</span>
        <span class="main-fullname">{{ datas.name }}</span>
      </div>
    </div>
    
  </div>

  <!-- Featured Posts -->
  <div class="feed">
    {% for post in suggested_posts %}
    <!-- âœ… SINGLE POST (VIDEO) -->
    <div class="post-card">
      <!-- ðŸ”¥ USER OVERLAY -->
      <a href="{% url 'suggested_user_profile' post.username %}">
        <div class="post-header">
          <img
            src="{{ post.profile_image|default:'/static/images/default-user.png' }}"
            class="post-user-logo"
          />
          <div>
            <span class="post-username">{{ post.username }}</span>
            <small>Suggested For You</small>
          </div>
        </div>
      </a>

      <!-- ðŸŽ¥ POST MEDIA -->
      <div
        class="reel-container"
        data-type="{% if post.image|lower|slice:'-4:' == '.mp4' %}video{% else %}image{% endif %}"
       
      >
        {% if post.image %}
            {% if post.image|lower|slice:"-4:" == ".mp4" %}
            <video class="post-media" autoplay muted loop playsinline >
              <source src="{{ post.image }}"  type="video/mp4"   />
              Your browser does not support the video tag.
            </video>
        {% else %}
        <img src="{{ post.image }}" class="post-media" />
        {% endif %}
        {% endif %}

        <div class="tap-indicator">
          <i class="bx bx-pause"></i>
          <span>Paused</span>
        </div>

        <!-- â¤ï¸ POST ACTIONS -->
        <div class="post-actions-vertical">
          <div class="action-btn likeBtn {% if post.liked %}liked{% endif %}" data-post-id="{{ post.id }}">
            <i class="bx {% if post.liked %}bxs-heart{% else %}bx-heart{% endif %}"></i>
            <span>{{ post.like_count }}</span>
          </div>

          <!-- COMMENT ACTION -->
          <div class="action-btn comment-wrapper">
            <i class="bx bx-comment"></i>
            <span>{{ post.comments|length }}</span>

            <!-- RIGHT COMMENT PANEL -->

            <div class="comment-panel">
              <!-- HEADER -->
              <div class="comment-header">
                <span>Comments</span>
                <i class="bx bx-x"></i>
              </div>

              <!-- COMMENT LIST -->
              <div class="comment-body">
                {% for c in post.comments %}
                
                <div class="comment-item">
                  {% if c.image %}
                  <img src="{{ c.image }}" class="comment-user-img" />
                  {% else %}
                  <img
                    src="{% static 'images/default-user.png' %}"
                    class="comment-user-img"
                  />
                  {% endif %}
                  <div class="comment-text">
                    <b>{{ c.username }} </b>
                    <span>{{ c.comment}}</span>
                  </div>
                </div>
                {% empty %}
                <p class="no-comments">No comments yet</p>
                {% endfor %}
              </div>

              <form class="comment-form" method="post" action="{% url 'add_comment' %}">
                {% csrf_token %}

                <!-- IMPORTANT -->
                <input type="hidden" name="post_id" value="{{ post.id }}" />

                <div class="comment-input-row">
                  <img
                    src="{{ profile.image|default:'/static/images/default-user.webp' }}"
                    class="comment-user-img"
                  />

                  <input
                    type="text"
                    name="comment"
                    placeholder="Add a comment..."
                    required
                  />
                </div>

                <button type="submit" class="comment-submit">Post</button>
              </form>
            </div>
          </div>
          
          <!-- âœ… SOUND ICON FOR VIDEO -->
          <div class="action-btn soundBtn">
            <i class="bx bx-volume-full"></i>
            <span>Sound</span>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <!-- COMMENT POPUP -->

   {% endblock %}
</div>
