{% extends 'base.html' %}
{% load static %}
{% block title %}suggested_profile{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/suggested_profile.css' %}" />{% endblock %}
{% block content %}


<div class="profile-header">

    <div class="profile-left">
        <img src="{{ profile.image|default:'/static/images/default-user.webp' }}" class="profile-photo">
    </div>

    <div class="profile-right">
        <div class="top-row">
            
            <h2 class="username">{{ user.username }}</h2>
            
           <form method="post" action ="{% url 'follow_user' user.username %}">
            {% csrf_token %}
                 {% if is_following %}
              <button class="follow-btn following" type="submit">
                Following
              </button>

            {% elif follows_you %}
              <button class="follow-btn follow-back" type="submit">
                Follow Back
              </button>

            {% else %}
              <button class="follow-btn" type="submit">
                Follow
              </button>
            {% endif %}

        </form>
        </div>

        <ul class="profile-stats">
            <li><span>{{ post_count }}</span> posts</li>
            <li><span>{{ followers_count }}</span> followers</li>
            <li><span>{{ following_count }}</span> following</li>
        </ul>

        <div class="user-bio">
           
            <p>{{ profile.bio|default:''}}</p>
            

        </div>
    </div>

</div>

<hr>

<div class="posts-grid">
    {% for post in posts %}
        <div class="post">
            <img src="{{ post.1 }}"  onclick="openViewPost('{{ post.1 }}', '{{ post.0 }}', '{{ post.2|escapejs }}')"
           class="grid-post">
           <p>{{ post.0 }}</p>
        </div>
    {% empty %}
        <p>No posts yet</p>
    {% endfor %}
</div>


<!-- VIEW POST POPUP -->
<div class="view-post-overlay" id="viewPostPopup">

  <div class="view-post-box">

    <!-- LEFT IMAGE -->
    <div class="view-post-left">
      <img id="viewPostImage" src="" />
    </div>

    <!-- RIGHT CONTENT -->
    <div class="view-post-right">

      <!-- HEADER -->
      <div class="view-post-header">
        <div class="view-user">
          <img src="{{ profile.image|default:'/static/images/xya.png' }}"
               class="view-user-pic">
          <span>{{ user.username }}</span>
        </div>
        <i class="bx bx-x close-popup"></i>
      </div>

      <!-- CAPTION / COMMENTS -->
      <div class="view-comments">
    <p><b>{{ user.username }}</b> 
         <span id="popupCaption"></span> 
        </p>
        </div>
        <!-- ACTIONS -->
      <div class="view-actions">
        <div>
          <a>
          <i class="bx bx-heart"></i>
          </a>
        </div>
        <i class="bx bx-bookmark"></i>
      </div>
      <!-- ADD COMMENT -->
       <form method="POST" action="{% url 'add_comment' %}">
    {% csrf_token %}
          <!-- IMPORTANT -->
          
                <input type="hidden" name="post_id" id="commentPostId" />
                <div class="view-add-comment">
        <textarea name="comment" type="text" placeholder="Add a commentâ€¦" required></textarea>
        <input type="submit" value="Post">
      </div>
    </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/suggested_profile.js' %}"></script>
{% endblock %}
